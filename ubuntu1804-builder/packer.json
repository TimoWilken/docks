{
  "_comment": "Ubuntu 18.04 builder X-enabled",
  "variables": {
    "DOCKER_HUB_REPO": "alisw"
  },
  "builders": [
    {
      "type": "docker",
      "image": "ubuntu:18.04",
      "commit": true
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "set -ex",
        "useradd -rUu 980 mesosalien",
        "useradd -rUu 981 mesosci",
        "useradd -rUu 982 mesosdaq",
        "useradd -rUu 983 mesosuser",
        "useradd -rUu 984 mesostest",
        "export DEBIAN_FRONTEND=noninteractive",
        "apt update -y",
        "apt upgrade -y",
        "apt install -y apt-utils",
        "apt install -y build-essential curl libcurl4-gnutls-dev gfortran swig autoconf automake autopoint unzip texinfo gettext libtool libtool-bin pkg-config libmysqlclient-dev xorg-dev libglu1-mesa-dev libfftw3-dev libxml2-dev flex bison libperl-dev libbz2-dev liblzma-dev libnanomsg-dev lsb-release rsync environment-modules libglfw3-dev libtbb-dev libncurses-dev libmotif-dev linux-headers-5.4.0-54-generic libkmod-dev libpci-dev rubygems-integration ruby-full git python-pip python-virtualenv python3-dev python3-venv python3-pip",
        "gem install --no-document fpm",
        "curl -L https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_linux_amd64.zip -o vault.zip",
        "unzip vault.zip && mv ./vault /usr/bin/vault && rm -f vault.zip"
      ]
    }
  ],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "{{user `DOCKER_HUB_REPO`}}/ubuntu1804-builder",
        "tag": "latest"
      },
      "docker-push"
    ]
  ]
}
